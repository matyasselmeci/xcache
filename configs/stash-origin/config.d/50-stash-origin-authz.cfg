#
# Configure authorization for the StashCache origin server.
#
# **********************************************************************
# * WARNING: DO NOT EDIT THIS FILE.  IT WILL BE OVERWRITTEN ON UPGRADE *
# **********************************************************************
#
# This file is part of the StashCache Daemon
# https://opensciencegrid.org/docs/data/stashcache/overview/

# Enable the authorization module, even if we have an unauthenticated instance.
ofs.authorize 1
# Log both successes and failures in authorization.
acc.audit deny grant


# xrootd config does not do nested "unqualified" ifs
if defined ?StashOriginAuthfile && named stash-origin-auth
   acc.authdb $StashOriginAuthfile
# nor negations ("!")
else if named stash-origin-auth
   acc.authdb /run/stash-origin-auth/Authfile
fi



if named stash-origin

   xrd.allow host *
   sec.protocol  host
   sec.protbind  * none

fi

# xrootd config does not do nested "unqualified" ifs
if defined ?StashOriginPublicAuthfile && named stash-origin
   acc.authdb $StashOriginPublicAuthfile
# nor negations ("!")
else if named stash-origin
   acc.authdb /run/stash-origin/Authfile
fi

# Allow scitokens always, whether auth origin or not.
if defined ?StashOriginSciTokensConf
    ofs.authlib ++ libXrdAccSciTokens.so config=$StashOriginSciTokensConf
else
    ofs.authlib ++ libXrdAccSciTokens.so config=/run/stash-origin-auth/scitokens.conf
fi
